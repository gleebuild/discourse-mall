
<!doctype html><meta charset="utf-8">
<div class="mall-hero"><h2>商城管理</h2></div>
<div class="mall-admin-tabs">
  <a href="/mall/admin?tab=products">产品</a>
  <a href="/mall/admin?tab=coupons">优惠券</a>
  <a href="/mall/admin?tab=orders">订单</a>
</div>

<% if @tab == 'products' %>
  <div style="margin:10px 0">
    <form action="/admin/plugins/mall.json" method="get" onsubmit="return false">
      <a class="btn btn-primary" href="#" onclick="document.getElementById('newProductForm').style.display='block'">+ 创建产品</a>
    </form>
  </div>
  <div id="newProductForm" style="display:none">
    <form class="mall-form" action="/mall-api/admin/products" method="post">
      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
      <label>标题</label><input name="title" required>
      <label>描述</label><input name="description">
      <label>主图URL</label><input name="image_url">
      <label>价格(分)</label><input name="price_cents" type="number" value="100">
      <label>库存</label><input name="stock" type="number" value="9999">
      <button class="btn btn-primary" type="submit">保存</button>
    </form>
  </div>
  <table class="mall-table">
    <tr><th>ID</th><th>标题</th><th>价格</th><th>状态</th></tr>
    <% @products.each do |p| %>
      <tr>
        <td><%= p.id %></td>
        <td><a href="/mall/p/<%= p.id %>"><%= p.title %></a></td>
        <td>¥ <%= (p.price_cents.to_i/100.0).round(2) %></td>
        <td><%= p.status %></td>
      </tr>
    <% end %>
  </table>
<% elsif @tab == 'coupons' %>
  <div style="margin:10px 0">
    <a class="btn btn-primary" href="#" onclick="document.getElementById('newCouponForm').style.display='block'">+ 创建优惠券</a>
  </div>
  <div id="newCouponForm" style="display:none">
    <form class="mall-form" action="/mall-api/admin/coupons" method="post">
      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
      <label>券码</label><input name="code" required>
      <label>类型</label>
      <select name="discount_type"><option value="amount">直减(分)</option><option value="percent">折扣(%)</option></select>
      <label>数值</label><input name="value" type="number" value="100">
      <label>有效期(YYYY-MM-DD 可选)</label><input name="expires_at" placeholder="2025-12-31">
      <button class="btn btn-primary" type="submit">保存</button>
    </form>
  </div>
  <table class="mall-table">
    <tr><th>ID</th><th>码</th><th>类型</th><th>值</th><th>有效期</th><th>作废</th></tr>
    <% @coupons.each do |c| %>
      <tr>
        <td><%= c.id %></td>
        <td><%= c.code %></td>
        <td><%= c.discount_type %></td>
        <td><%= c.amount? ? c.value_cents : c.value_percent %></td>
        <td><%= c.expires_at&.strftime('%F') %></td>
        <td><%= c.voided %></td>
      </tr>
    <% end %>
  </table>
<% else %>
  <table class="mall-table">
    <tr><th>ID</th><th>SN</th><th>用户</th><th>金额</th><th>状态</th><th>快递</th><th>单号</th></tr>
    <% @orders.each do |o| %>
      <tr>
        <td><%= o.id %></td>
        <td><%= o.sn %></td>
        <td><%= o.user_id %></td>
        <td>¥ <%= (o.total_cents.to_i/100.0).round(2) %></td>
        <td><%= o.status %></td>
        <td><%= o.express_company %></td>
        <td><%= o.express_no %></td>
      </tr>
    <% end %>
  </table>
<% end %>
